<!-- Main Container -->
<div class="min-h-screen p-4 bg-base-100">
  <div class="container mx-auto max-w-4xl">
    <div class="card bg-base-200 shadow-xl">
      <div class="card-body p-6 sm:p-8">
        <!-- Header -->
        <div class="mb-8">
          <h2 class="text-2xl sm:text-3xl font-bold">Share Your Setup</h2>
          <p class="text-base-content/70 mt-2">Show off your workspace to the community</p>
        </div>

        <!-- Form -->
        <form [formGroup]="setupForm" (ngSubmit)="onSubmit()" (keydown.enter)="$event.preventDefault()" 
              class="space-y-8">
          
          <!-- Title Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Title*</span>
              <span class="label-text-alt">
                <span class="text-base-content/70" *ngIf="!setupForm.get('title')?.errors">
                  {{ setupForm.get('title')?.value?.length || 0 }}/50
                </span>
              </span>
            </label>
            <input type="text"
                   formControlName="title"
                   placeholder="Give your setup a catchy title"
                   class="input input-bordered w-full bg-base-300 transition-all duration-200 hover:bg-base-300/80 focus:bg-base-300/90"
                   [ngClass]="{'input-error': setupForm.get('title')?.invalid && setupForm.get('title')?.touched}"
                   [maxlength]="50"/>
            <div class="label" *ngIf="setupForm.get('title')?.invalid && setupForm.get('title')?.touched">
              <span class="label-text-alt text-error flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                <ng-container *ngIf="setupForm.get('title')?.errors?.['required']">
                  Title is required
                </ng-container>
                <ng-container *ngIf="setupForm.get('title')?.errors?.['minlength']">
                  Title must be at least 2 characters
                </ng-container>
                <ng-container *ngIf="setupForm.get('title')?.errors?.['maxlength']">
                  Title cannot exceed 50 characters
                </ng-container>
              </span>
            </div>
          </div>

          <!-- Description Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Description</span>
              <span class="label-text-alt">
                <span class="text-base-content/70" *ngIf="!setupForm.get('description')?.errors">
                  {{ setupForm.get('description')?.value?.length || 0 }}/1000
                </span>
              </span>
            </label>
            <textarea formControlName="description"
                      placeholder="Tell us about your setup..."
                      class="textarea textarea-bordered h-32 bg-base-300 transition-all duration-200 hover:bg-base-300/80 focus:bg-base-300/90"
                      [ngClass]="{'input-error': setupForm.get('description')?.invalid && setupForm.get('description')?.touched}"
                      [maxlength]="1000"></textarea>
            <div class="label" *ngIf="setupForm.get('description')?.invalid && setupForm.get('description')?.touched">
              <span class="label-text-alt text-error flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                <ng-container *ngIf="setupForm.get('description')?.errors?.['maxlength']">
                  Description cannot exceed 1000 characters
                </ng-container>
              </span>
            </div>
          </div>

          <!-- Categories Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Categories*</span>
            </label>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              <div *ngFor="let category of categories"
                   class="card bg-base-300 hover:bg-base-300/90 cursor-pointer transition-all duration-300 transform hover:scale-[1.02]"
                   [class.ring-2]="isSelected(category.id)"
                   [class.ring-primary]="isSelected(category.id)"
                   (click)="toggleCategory(category.id)">
                <div class="card-body p-4">
                  <div class="flex items-center gap-3">
                    <div class="flex-none">
                      <i [class]="category.icon + ' text-xl'"
                         [class.text-primary]="isSelected(category.id)"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="font-medium truncate" [class.text-primary]="isSelected(category.id)">
                        {{ category.name }}
                      </h3>
                      <p class="text-xs opacity-70 line-clamp-2">{{ category.description }}</p>
                    </div>
                    <div class="flex-none">
                      <input type="checkbox"
                             class="checkbox checkbox-primary checkbox-sm"
                             [checked]="isSelected(category.id)"
                             (click)="$event.stopPropagation()"
                             (change)="toggleCategory(category.id)"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="label" *ngIf="setupForm.get('categories')?.errors?.['required'] && setupForm.get('categories')?.touched">
              <span class="label-text-alt text-error flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                Select at least one category
              </span>
            </div>
          </div>

          <!-- Images Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Images* (Min 1, Max 5)</span>
            </label>
            <div class="flex flex-col gap-4">
              <input type="file"
                     multiple
                     accept="image/*"
                     (change)="onImagesSelected($event)"
                     class="file-input file-input-bordered w-full bg-base-300 transition-all duration-200 hover:bg-base-300/80 focus:bg-base-300/90"/>

              <!-- Image Preview Grid -->
              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" 
                   *ngIf="imagePreviewUrls.length > 0">
                <div *ngFor="let url of imagePreviewUrls; let i = index" 
                     class="relative group aspect-square">
                  <img [src]="url" 
                       class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-[1.02]"/>
                  <button type="button"
                          (click)="removeImage(i)"
                          class="btn btn-circle btn-sm btn-error absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="label" *ngIf="setupForm.get('images')?.errors?.['required'] && setupForm.get('images')?.touched">
              <span class="label-text-alt text-error flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                At least one image is required
              </span>
            </div>
          </div>

          <!-- Video Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Video (Optional, Max 1)</span>
            </label>
            <div class="flex flex-col gap-4">
              <input type="file"
                     accept="video/*"
                     (change)="onVideosSelected($event)"
                     class="file-input file-input-bordered w-full bg-base-300 transition-all duration-200 hover:bg-base-300/80 focus:bg-base-300/90"/>

              <!-- Video Preview -->
              <div class="grid grid-cols-1 gap-4" *ngIf="videoPreviewUrls.length > 0">
                <div *ngFor="let url of videoPreviewUrls; let i = index" 
                     class="relative group aspect-video">
                  <video [src]="url" 
                         class="w-full h-full object-cover rounded-lg"
                         controls></video>
                  <button type="button"
                          (click)="removeVideo(i)"
                          class="btn btn-circle btn-sm btn-error absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Tags Section -->
          <div class="form-control">
            <label class="label">
              <span class="label-text text-base font-medium">Tags* (Min 3, Max 15)</span>
              <span class="label-text-alt">
                <span class="text-base-content/70" *ngIf="!setupForm.get('tags')?.errors">
                  {{ selectedTags.length }}/15
                </span>
              </span>
            </label>

            <!-- Selected Tags -->
            <div class="flex flex-wrap gap-2 mb-4">
              <div *ngFor="let tag of selectedTags" 
                   class="badge badge-primary gap-2 p-3 transition-all duration-200 hover:scale-105">
                {{ tag.name }}
                <button type="button" 
                        (click)="removeTag(tag)"
                        class="hover:text-error transition-colors duration-200">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>

            <!-- Tag Input -->
            <div class="join w-full">
              <input type="text"
                     [(ngModel)]="tagInput"
                     [ngModelOptions]="{standalone: true}"
                     (keyup.enter)="addTag(); $event.preventDefault();"
                     placeholder="Add tags (press Enter)"
                     class="input input-bordered join-item flex-1 bg-base-300 transition-all duration-200 hover:bg-base-300/80 focus:bg-base-300/90"/>
              <button type="button"
                      class="btn join-item bg-base-100 hover:bg-primary hover:text-primary-content transition-all duration-200"
                      (click)="addTag()">
                <i class="fas fa-plus mr-2"></i>
                Add Tag
              </button>
            </div>

            <div class="label" *ngIf="setupForm.get('tags')?.invalid && setupForm.get('tags')?.touched">
              <span class="label-text-alt text-error flex items-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                <ng-container *ngIf="setupForm.get('tags')?.errors?.['required']">
                  At least 3 tags are required
                </ng-container>
                <ng-container *ngIf="setupForm.get('tags')?.errors?.['minlength']">
                  Minimum 3 tags required
                </ng-container>
                <ng-container *ngIf="setupForm.get('tags')?.errors?.['maxlength']">
                  Maximum 15 tags allowed
                </ng-container>
              </span>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="card-actions justify-end pt-4">
            <button type="submit"
                    class="btn btn-primary gap-2 transition-all duration-300 hover:scale-105"
                    [disabled]="isSubmitting || !isFormValid()">
              <i class="fas fa-share"></i>
              {{ isSubmitting ? 'Sharing...' : 'Share Setup' }}
              <span class="text-xs opacity-70" *ngIf="!isFormValid()">
                (Fill all required fields)
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
